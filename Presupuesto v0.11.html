<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Presupuesto v10.0</title>
    <style>
        @media print {
            .ocultar-al-imprimir img button {
                display: none;
            }
        }

        body {
            /* Estilo general */
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
            /* Fondo fuera de la hoja */
            display: flex;
            justify-content: center;
        }

        .invoice-container {
            max-width: 21cm;
            /* width: 21cm; */
            /* Ancho A4 */
            max-height: 29,7cm;
            /* height: 29.7cm; */
            /* Alto A4 */
            background-color: #fff;
            /* Fondo de la hoja */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            color: #000;
            /* Color del Texto */
            padding: 1cm 1cm;
            box-sizing: border-box;
            line-height: 1.5;
            font-size: 10pt;
            display: flex;
            flex-direction: column;
        }

        /* HEADER */
        .header {
            /* Logo */
            display: flex;
            justify-content: space-between;
            margin-bottom: 40px;
            width: 100%;
            height: 4cm;
            background: #f2f2f2 url('banner.jpg') left/cover no-repeat;
            /*Logo de fondo*/
        }

        .header-info {
            /* Informaci√≥n de logo */
            text-align: right;
            line-height: 1.3;
            font-size: 10pt;
            font-family: 'Roboto Mono', monospace;
            font-weight: 700;
            color: #fff;
            /* Color de texto sobre logo*/
            margin: auto 1cm;
            /* Margen vertical y horizontal */
        }

        .header-info div:first-child {
            font-size: 10pt;
            margin-bottom: 5px;
        }

        /* NEW STYLES FOR DATE INPUT */
        .date-input {
            border: none;
            background: none;
            text-align: right;
            font-family: 'Roboto Mono', monospace;
            font-weight: 700;
            color: #fff;
            /* Color de texto sobre logo*/
            font-size: 12pt;
            outline: none;
            cursor: default;
            /* Hide the default date picker icon until focus */
            /* This is a tricky property across browsers, but helps for a cleaner look */
            /* The input is set to be readonly when not in edit mode via JS */
            padding: 0;
            margin-right: -1.1cm;
            line-height: 1.3;
            height: 19pt;
            width: 3.5cm;
            box-sizing: border-box;
        }

        .date-input:focus {
            /* Show a light border when focused and editable */
            border: 1px dashed #fff;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.2);
            width: 3.6cm;
        }
        
        input[type="date"]::-webkit-calendar-picker-indicator {
             display: none;
        }


        /* TITLE SECTION */
        .title-section {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 30px;
            padding-top: 20px;
            border-top: 1px solid #1a1a1a;
        }

        .title-section h1 {
            font-family: 'Oswald', sans-serif;
            font-size: 32pt;
            font-weight: 500;
            margin: 0;
            letter-spacing: 2px;
        }

        .title-section .num {
            font-family: 'Roboto Mono', monospace;
            font-size: 10pt;
            color: #555;
            margin-top: 5px;
        }

        /* CLIENT/PROJECT SUMMARY */
        .summary {
            display: flex;
            margin-bottom: 40px;
            gap: 50px;
        }

        .summary-block {
            line-height: 1.6;
        }

        .summary-block strong {
            font-weight: bold;
            font-size: 12pt;
            display: block;
            margin-bottom: 5px;
        }

        .summary-block span {
            color: #555;
        }

        /* ITEMS TABLE */
        .items-header {
            display: flex;
            justify-content: space-between;
            font-weight: bold;
            border-bottom: 1px solid #1a1a1a;
            padding-bottom: 5px;
            margin-bottom: 10px;
        }

        .items-header .detail-col {
            width: 60%;
        }

        .items-header .cost-col {
            width: 30%;
            text-align: right;
        }

        .item-group {
            margin-bottom: 20px;
        }

        .item-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
        }

        .item-row.main {
            font-weight: bold;
        }

        .item-row.sub {

            font-size: 9pt;
            color: #555;
            display: flex;
            /* Ensure item details and cost align */
            width: 100%;
        }

        .item-row .detail {
            width: 50%;
        }

        .item-row .cost {
            width: 20%;
            text-align: right;
        }

        /* CONDITIONS, TOTAL, PAYMENT */
        .footer {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
        }

        .conditions-block {
            width: 50%;
            font-size: 8pt;
            line-height: 1.4;
            color: #333;
        }

        .conditions-block strong {
            display: block;
            font-size: 10pt;
            margin-bottom: 10px;
            color: #1a1a1a;
        }

        .conditions-block ol {
            padding-left: 15px;
            margin: 0;
        }

        .conditions-block li {
            margin-bottom: 10px;
        }

        .financial-block {
            width: 40%;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .total-box {
            text-align: center;
        }

        .total-row {
            border-top: 1px solid #ccc;
            display: flex;
            justify-content: center;
            align-items: baseline;
            margin-bottom: 10px;
        }

        .total-row .label {
            font-size: 14pt;
            font-weight: bold;
            margin-right: 15px;
            letter-spacing: 1px;
        }

        .total-row .amount {
            font-family: 'Roboto Mono', monospace;
            font-size: 20pt;
            font-weight: 700;
            color: #1a1a1a;
        }

        .delivery-time .amount {
            font-family: 'Roboto Mono', monospace;
            font-size: 15pt;
            font-weight: 700;
            color: #1a1a1a;
        }


        .ars {
            font-size: 10pt;
            font-weight: normal;
            vertical-align: top;
            margin-left: 5px;
            color: #555;
        }

        .ars2 {
            font-size: 7pt;
            font-weight: normal;
            vertical-align: top;
            margin-left: 5px;
            color: #555;
        }

        .delivery-time {
            text-align: center;
            font-size: 10pt;
            margin-top: -10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #ccc;
        }

        .delivery-time strong {
            font-weight: bold;
        }

        .payment-methods {
            font-size: 9pt;
            line-height: 1.6;
            text-align: center;

        }

        .payment-methods strong {
            font-weight: bold;
            display: block;
            font-size: 10pt;
            margin-bottom: 5px;
        }

        /* FOOTER CONTACT */
        .contact {
            margin-top: 60px;
            padding-top: 20px;
            border-top: 1px solid #1a1a1a;
            text-align: center;
            font-size: 12pt;
            display: flex;
            justify-content: center;
            gap: 40px;
            border-collapse: collapse;
        }

        a {
            color: #000;
            text-decoration: none;
        }

        ul {
            list-style: '> ';
            padding-left: 15px;
            margin: 0;
        }

        /* Added for editing visualization */
        [contenteditable="true"] {
            border: 1px dashed #ccc;
            padding: 2px;
            outline: none;
        }

        .controls {
            margin-top: 5px;
            margin-right: 0px;
            text-align: center;
        }

        .controls button {
            padding: 8px 15px;
            margin: 5px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            border-radius: 5px;
        }

        #editButton {
            background-color: #007bff;
            color: white;
        }

        #addItemButton {
            background-color: #28a745;
            color: white;
        }

        #printButton {
            background-color: #696969;
            color: white;
        }

        .delete-item-btn {
            background: none;
            border: none;
            color: #dc3545;
            font-size: 12pt;
            cursor: pointer;
            padding: 0 5px;
            line-height: 1;
            margin-left: 10px;
            visibility: hidden;
            /* Hide by default */
        }

        /* Ensure .detail and .cost take up space */
        .item-row.sub .detail {
            flex-grow: 1;
            min-width: 50%;
        }

        .item-row.sub .cost {
            width: 50px;
        }

        #items-ul li:nth-child(odd) {
            background-color: #eee;
            border-radius: 5px;
            padding: 0px 10px;
        }

        #items-ul li:nth-child(even) {
            background-color: #fff;
            border-radius: 5px;
            padding: 0px 10px;
        }

        .item-row sub {
            display: block;
        }

        img {
            height: 20pt;
            display: initial; /* None para no mostrar*/
        }
    </style>
</head>

<body>
    <div class="invoice-container">
        <div class="header" id="headerContent">
            <div class="logo"></div>
            <div class="header-info">
                <input type="date" id="invoiceDate" class="date-input">
                <div id="companyName">Mat√≠as A. Santoro</div>
                <div id="companyCuit">20-40493208-0</div>
                <div class="controls">
                    <button id="editButton" class="ocultar-al-imprimir" onclick="toggleEdit()">üìù Editar
                        Contenido</button>
                    <button id="printButton" class="ocultar-al-imprimir" onclick="print()">üñ® Imprimir
                        Contenido</button>
                </div>
            </div>
        </div>

        <div class="title-section">
            <h1>PRESUPUESTO</h1>
            <div class="num">‚Äî NUM. <span id="invoiceNumber">X</span></div>
        </div>

        <div class="summary">
            <div class="summary-block client">
                <strong>Cliente</strong>
                <span contenteditable="false">Marcelo G√≥mez</span>
            </div>
            <div class="summary-block project">
                <strong>Proyecto</strong>
                <span contenteditable="false">Vectorizaci√≥n de im√°genes</span>
            </div>
        </div>

        <div class="items-list">
            <div class="items-header">
                <div class="detail-col">Detalle</div>
                <div class="cost-col">Costo / Valor</div>
            </div>

            <div class="item-group">
                <div class="item-row main">
                    <div class="detail" contenteditable="false">Vectorizaci√≥n + Entrega de Originales</div>
                    <div class="cost"></div>
                </div>
                <ul id="items-ul" class="estilo-tiras">
                    <li>
                        <div class="item-row sub">
                            <div class="detail" contenteditable="false">Vectorizaci√≥n x1 ("Death from above")</div>
                            <button class="delete-item-btn" onclick="removeItem(this)">‚ùå</button>
                            <div class="cost" contenteditable="false" onblur="updateTotals()">$11.000</div>
                        </div>
                    </li>
                    <li>
                        <div class="item-row sub">
                            <div class="detail" contenteditable="false">Vectorizaci√≥n x3 (Emblemas Troopers)</div>
                            <button class="delete-item-btn" onclick="removeItem(this)">‚ùå</button>
                            <div class="cost" contenteditable="false" onblur="updateTotals()">$25.000</div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>

        <div class="controls" style="margin-top: -20px;">
            <button id="addItemButton" onclick="addNewItem()" style="display:none;">‚ûï Agregar Item</button>
        </div>
        <div class="footer">

            <div class="conditions-block">
                <strong>Condiciones</strong>
                <ol id="conditions-list">
                    <li>Los archivos finales y/o originales no ser√°n entregados hasta que el pago total sea abonado y
                        confirmado mediante un comprobante.</li>
                    <li>No se permitir√° la reducci√≥n del tiempo del proyecto ni la entrega anticipada. Se respetar√° el
                        plazo de entrega estipulado, salvo casos de fuerza mayor o ajenos a las gestiones.</li>
                    <li>No se efectuar√°n cambios al proyecto y/o archivos luego de su entrega completa en el plazo
                        estipulado. De necesitar modificaciones que no se encuentren dentro de los plazos
                        correspondientes, se armar√° un nuevo presupuesto.</li>
                </ol>
            </div>

            <div class="financial-block">
                <div class="total-box">
                    <div class="total-row">
                        <span class="label">TOTAL: </span>
                        <span class="amount" id="totalAmount">$0<span class="ars">ARS</span></span>
                    </div>
                    <div class="delivery-time">
                        <div>Plazo estimado de entrega: <strong contenteditable="false" id="deliveryTime">1
                                Semana</strong></div>
                        <div>Se√±a del 50%: <strong class="amount" id="depositAmount">$0</strong><span
                                class="ars2">ARS</span></div>
                    </div>
                </div>

                <div class="payment-methods">
                    <strong>M√©todos de Pago:</strong>
                    <div><b>Alias:</b> matias.santoro.mp</div>
                    <div><b>CBU:</b> 0140036603710355419484</div>
                    <div><i><a href="mailto:msantoro85@hotmail.com">(Transferencia Bancaria)</i></></div>
                </div>
            </div>
        </div>

        <div class="contact">      
            <div><a href="https://instagram.com/msantoro.dsg" target="_blank"><img src="https://static.cdninstagram.com/rsrc.php/v4/yI/r/VsNE-OHk_8a.png" alt="Instagram"> @msantoro.dsg</a>
            </div>
            <span>|</span>
            <div><a href="mailto:msantoro.dsg@gmail.com"><img src="https://ssl.gstatic.com/ui/v1/icons/mail/rfr/logo_gmail_lockup_default_1x_r5.png" alt="Correo Electr√≥nico"> msantoro.dsg@gmail.com</a>
            </div>
            <span>|</span>
            <div><a href="https://wa.me/+543487366401"><img src="https://static.whatsapp.net/rsrc.php/v4/yP/r/rYZqPCBaG70.png" alt="WhatsApp"></a><a href="tel:+543487366401" alt="Tel√©fono"> +54|3487|366401</a>
            </div>
        </div>

    </div>

    <script>
        // Set the default date (e.g., today's date) when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            const dateInput = document.getElementById('invoiceDate');
            // Set the default value to a fixed date or today's date if empty
            if (!dateInput.value) {
                // Example: November 5, 2025 in YYYY-MM-DD format
                dateInput.value = '2025-11-05';
            }
            // Set date input to readonly initially
            dateInput.setAttribute('readonly', true);
            updateTotals(); // Initial calculation on load
        });

        // Elements to make editable (updated to use new IDs and exclude the date input)
        /* '#invoiceNumber, #companyName, #companyCuit, .summary span, .item-row .detail, .item-row .cost, #conditions-list, #deliveryTime, .payment-methods div:not(:first-child), .contact' */
        const editableElements = document.querySelectorAll(
            '#invoiceNumber, .summary span, .item-row .detail, .item-row .cost, #deliveryTime'
        );

        const editButton = document.getElementById('editButton');
        const addItemButton = document.getElementById('addItemButton');
        const removeItemButton = document.getElementById('removeItemButton');
        const ul = document.getElementById('items-ul');
        const invoiceDateInput = document.getElementById('invoiceDate');
        let isEditing = false;

        /**
         * Toggles contentEditable attribute for all marked elements and shows/hides control buttons.
         */
        function toggleEdit() {
            isEditing = !isEditing;

            editableElements.forEach(el => {
                // The item-row .detail and .cost cells are handled separately when adding a new item
                if (el.classList.contains('detail') || el.classList.contains('cost')) {
                    // Only sub-item details and costs should be toggled
                    if (el.closest('.item-row') && el.closest('.item-row').classList.contains('sub')) {
                        el.contentEditable = isEditing;
                    }
                } else {
                    el.contentEditable = isEditing;
                }
            });

            // Specific handling for the date input's readonly attribute
            if (isEditing) {
                invoiceDateInput.removeAttribute('readonly');
                // Optional: make the cursor visible for editing
                invoiceDateInput.style.pointerEvents = 'auto';

                editButton.textContent = 'üíæ Guardar Cambios';
                editButton.style.backgroundColor = '#dc3545'; // Red for "Save"
                addItemButton.style.display = 'inline-block'; // Show "Add Item" button

            } else {
                invoiceDateInput.setAttribute('readonly', true);
                invoiceDateInput.style.pointerEvents = 'none'; // Prevents opening picker

                editButton.textContent = 'üìù Editar Contenido';
                editButton.style.backgroundColor = '#007bff'; // Blue for "Edit"
                addItemButton.style.display = 'none'; // Hide "Add Item" button

                updateTotals(); // Recalculate totals after saving
            }

            // Toggle item delete buttons visibility
            document.querySelectorAll('.delete-item-btn').forEach(btn => {
                btn.style.visibility = isEditing ? 'visible' : 'hidden';
            });

            // Selecciona todos los elementos que tengan el atributo contenteditable
            let elements = document.querySelectorAll('[contenteditable]');

            // Itera sobre cada elemento seleccionado
            elements.forEach(function (element) {
                // Establece el valor del atributo contenteditable a 'false'
                element.setAttribute('contenteditable', isEditing ? 'true' : 'false');
            });

        }

        /**
         * Agrega un nuevo elemento de lista al presupuesto.
         */
        function addNewItem() {
            const newLi = document.createElement('li');
            newLi.innerHTML = `
                <div class="item-row sub">
                    <div class="detail" contenteditable="true" onclick="finishEditing(this)">Nuevo Item (Descripci√≥n)</div>
                    <button class="delete-item-btn" onclick="removeItem(this)">‚ùå</button>
                    <div class="cost" contenteditable="true" onblur="finishEditing(this)">$ 0</div>
                </div>
            `;
            // Aseg√∫rate de que los nuevos √≠tems sean editables si ya est√°s en modo de edici√≥n
            if (isEditing) {
                newLi.querySelectorAll('.delete-item-btn').forEach(btn => btn.style.visibility = 'visible');
            }
            ul.appendChild(newLi);
            // Enfoca en el nuevo detalle para edici√≥n inmediata
            newLi.querySelector('.detail').focus();
            updateTotals(); // Actualiza totales
        }

        /**
         * Removes a specific item when its individual delete button is clicked.
         * @param {HTMLElement} button - The clicked delete button element.
         */
        function removeItem(button) {
            // Traverse up to find the closest <li> (the item container)
            const li = button.closest('li');
            if (li) {
                ul.removeChild(li);
                updateTotals(); // Recalculate totals after removal
            }
        }

        /**
        * Termina la edici√≥n de un elemento, eliminando el atributo contenteditable.
        * @param {HTMLElement} element - El elemento que se acaba de editar (detail o cost).
        */
        function finishEditing(element) {
            // Verifica si el modo de edici√≥n no est√° activo
            // Si el modo de edici√≥n est√° activo, no quitamos el borde punteado para permitir la edici√≥n continua
            if (!isEditing) {
                element.setAttribute('contenteditable', 'false');
            }
            // Si el elemento es un costo, llama a updateTotals
            if (element.classList.contains('cost')) {
                updateTotals();
            }
        }

        /**
         * Calcula el costo total y el monto del dep√≥sito del 50%.
         */
        function updateTotals() {
            const costElements = document.querySelectorAll('.item-row.sub .cost');
            let total = 0;

            costElements.forEach(costEl => {
                // Extract number, remove non-digit/non-decimal characters (like $, space, comma)
                const text = costEl.textContent.replace(/[$.]/g, ''); // Remove $ and dot thousands separators
                const value = parseFloat(text.replace(',', '.')); // Replace comma with dot for float parsing

                if (!isNaN(value)) {
                    total += value;
                }
                // Ensure the cost field is formatted correctly (e.g., $ 11.000)
                if (isEditing) {
                    costEl.textContent = `$ ${value.toLocaleString('es-AR', { minimumFractionDigits: 0 })}`;
                }
            });

            // Calculate deposit
            const deposit = total * 0.50;

            // Format numbers with thousands separator (e.g., in Spanish 'es-AR')
            const totalFormatted = total.toLocaleString('es-AR', { minimumFractionDigits: 0 });
            const depositFormatted = deposit.toLocaleString('es-AR', { minimumFractionDigits: 0 });

            // Update DOM
            document.getElementById('totalAmount').innerHTML = `$${totalFormatted}<span class="ars">ARS</span>`;
            document.getElementById('depositAmount').textContent = `$${depositFormatted}`;
        }
    </script>
</body>

</html>